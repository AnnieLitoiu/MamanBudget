{% extends 'base.html.twig' %}

{% block title %}Profil | MamanSolo{% endblock %}

{% block body %}
  <div class="page-container">
    <div class="profile-page">
      <h1 class="profile-title">Personnalise ton personnage ğŸ’•</h1>
      <p class="profile-subtitle">
        Bonjour {{ utilisateur.nom }}, complÃ¨te ta situation et choisis ton avatar.
      </p>

      <form method="post">
        <div class="profile-flex">

          {# BOX 1 : Situation #}
          <div class="auth-wrapper profile-box">
            <h2>ğŸ‘¸ Je choisi ma situation</h2>

            {# 1) Nombre dâ€™enfants #}
            <div class="choice-section">
              <p class="field-label" style="text-align:center;">nombre dâ€™enfants</p>
              <div class="choice-grid">
                {% for choice in situationForm.nbEnfants %}
                  <label class="choice-card {% if choice.vars.checked %}is-active{% endif %}">
                    {{ form_widget(choice, { attr: { class: 'hidden-radio' } }) }}
                    <div class="choice-icon">
                      {% if choice.vars.value == '1' %}
                        ğŸ‘©â€ğŸ‘§
                      {% elseif choice.vars.value == '2' %}
                        ğŸ‘©â€ğŸ‘§â€ğŸ‘¦
                      {% else %}
                        ğŸ‘©â€ğŸ‘§â€ğŸ‘§â€ğŸ‘¦
                      {% endif %}
                    </div>
                    <div class="choice-label">{{ choice.vars.label }}</div>
                  </label>
                {% endfor %}
              </div>
            </div>

            {# 2) Type de logement #}
            <div class="choice-section">
              <p class="field-label" style="text-align:center;">type de logement</p>
              <div class="choice-grid">
                {% for choice in situationForm.logement %}
                  <label class="choice-card logement-card {% if choice.vars.checked %}is-active{% endif %}">
                    {{ form_widget(choice, { attr: { class: 'hidden-radio' } }) }}
                    <div class="choice-icon">
                      {% if choice.vars.value == 'studio' %}
                        ğŸ›ï¸
                      {% elseif choice.vars.value == 'appartement' %}
                        ğŸ¢
                      {% elseif choice.vars.value == 'penthouse' %}
                        ğŸ™ï¸
                      {% elseif choice.vars.value == 'villa' %}
                        ğŸ¡
                      {% else %}
                        ğŸ 
                      {% endif %}
                    </div>
                    <div class="choice-label">{{ choice.vars.label }}</div>
                  </label>
                {% endfor %}
              </div>
            </div>

            {# === Revenu mensuel avec slider === #}

            {# on rÃ©cupÃ¨re la valeur numÃ©rique ou 0 par dÃ©faut #}
            {% set revenuMensuel = situationForm.revenuMensuel.vars.value|default(0)|number_format(0, '.', '') %}

            <div class="choice-section">
            <p class="field-label">Revenu mensuel (â‚¬)</p>

            <input
                type="range"
                id="revenu-slider"
                min="0"
                max="5000"
                step="100"
                value="{{ revenuMensuel }}"
            >

            <div class="revenu-display">
                <span>Mensuel : </span>
                <strong id="revenu-mensuel-val">{{ revenuMensuel }} â‚¬</strong>
            </div>

            <div class="revenu-display">
                <span>Hebdomadaire estimÃ© : </span>
                <strong id="revenu-hebdo-val">
                {{ (revenuMensuel / 4)|round(0, 'floor') }} â‚¬
                </strong>
            </div>

            {# champ Symfony cachÃ© #}
            {{ form_widget(situationForm.revenuMensuel, {
                attr: { id: 'revenu-hidden', style: 'display:none;' }
            }) }}
            </div>

            {{ form_rest(situationForm) }}
          </div>




{# ğŸ¨ BOX 2 : Avatar #}
<div class="auth-wrapper profile-box">
  <h2>ğŸ¨ Je construis mon avatar</h2>

  {# 1) Couleur de peau #}
  <div class="choice-section">
    <p class="field-label" style="text-align:center;">Couleur de peau</p>
    <div class="choice-grid">
      {% for choice in avatarForm.couleurPeau %}
        <label class="choice-card {% if choice.vars.checked %}is-active{% endif %}">
          {{ form_widget(choice, { attr: { class: 'hidden-radio' } }) }}
          <div class="choice-icon">
            {% if choice.vars.value == 'claire' %}
              ğŸ‘©ğŸ»
            {% elseif choice.vars.value == 'moyenne' %}
              ğŸ‘©ğŸ¼
            {% elseif choice.vars.value == 'mate' %}
              ğŸ‘©ğŸ½
            {% elseif choice.vars.value == 'foncee' %}
              ğŸ‘©ğŸ¾
            {% else %}
              ğŸ‘©ğŸ¿
            {% endif %}
          </div>
          <div class="choice-label">{{ choice.vars.label }}</div>
        </label>
      {% endfor %}
    </div>
  </div>

  {# 2) Couleur de cheveux #}
  <div class="choice-section">
    <p class="field-label" style="text-align:center;">Couleur de cheveux</p>
    <div class="choice-grid">
      {% for choice in avatarForm.couleurCheveux %}
        <label class="choice-card {% if choice.vars.checked %}is-active{% endif %}">
          {{ form_widget(choice, { attr: { class: 'hidden-radio' } }) }}
          <div class="choice-icon">
            {% if choice.vars.value == 'blonde' %}
              ğŸ’›
            {% elseif choice.vars.value == 'brune' %}
              ğŸ¤
            {% elseif choice.vars.value == 'noire' %}
              ğŸ–¤
            {% elseif choice.vars.value == 'rousse' %}
              ğŸ§¡
            {% else %}
              ğŸ’‡
            {% endif %}
          </div>
          <div class="choice-label">{{ choice.vars.label }}</div>
        </label>
      {% endfor %}
    </div>
  </div>

  {# 3) Style vestimentaire #}
  <div class="choice-section">
    <p class="field-label" style="text-align:center;">Style vestimentaire</p>
    <div class="choice-grid">
      {% for choice in avatarForm.styleVestimentaire %}
        <label class="choice-card {% if choice.vars.checked %}is-active{% endif %}">
          {{ form_widget(choice, { attr: { class: 'hidden-radio' } }) }}
          <div class="choice-icon">
            {% if choice.vars.value == 'decontractee' %}
              ğŸ¥¿
            {% elseif choice.vars.value == 'classique' %}
              ğŸ‘
            {% elseif choice.vars.value == 'sport' %}
              ğŸ‘Ÿ
            {% elseif choice.vars.value == 'businesswoman' %}
              ğŸ‘  
            {% else %}
              ğŸ‘•
            {% endif %}
          </div>
          <div class="choice-label">{{ choice.vars.label }}</div>
        </label>
      {% endfor %}
    </div>
  </div>

  {{ form_rest(avatarForm) }}
</div>


        </div>

        <button type="submit" class="btn-primary-ms" style="display:block; margin:2rem auto 0 auto; text-align:center;">
          Enregistrer et jouer
        </button>
      </form>
    </div>
  </div>

  <script>
    const slider = document.getElementById("revenu-slider");
    const mensuelSpan = document.getElementById("revenu-mensuel-val");
    const hebdoSpan = document.getElementById("revenu-hebdo-val");
    let hiddenInput = document.getElementById("revenu-hidden");

    if (!hiddenInput) {
      hiddenInput = document.querySelector('input[name$="[revenuMensuel]"], input[name$="[revenu_mensuel]"]');
    }

    console.log("[MamanSolo slider] slider =", slider);
    console.log("[MamanSolo slider] mensuelSpan =", mensuelSpan);
    console.log("[MamanSolo slider] hebdoSpan =", hebdoSpan);
    console.log("[MamanSolo slider] hiddenInput =", hiddenInput);

    function updateRevenu(val) {
      const montant = parseInt(val, 10) || 0;

      if (mensuelSpan) mensuelSpan.textContent = montant + " â‚¬";
      if (hebdoSpan) hebdoSpan.textContent = Math.floor(montant / 4) + " â‚¬";
      if (hiddenInput) hiddenInput.value = montant;
    }

    if (slider) {
      updateRevenu(slider.value);

      slider.addEventListener("input", e => updateRevenu(e.target.value));
      slider.addEventListener("change", e => updateRevenu(e.target.value));
    } else {
      console.warn("[MamanSolo slider] Pas de slider trouvÃ© dans la page.");
    }
  </script>
{% endblock %}
